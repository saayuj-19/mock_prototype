<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>{{ subject }} Quiz</title>

    <script defer>
        window.MathJax = {
            tex: {
                inlineMath: [['$$', '$$'], ['\\(', '\\)']],
                displayMath: [['\\[', '\\]']]
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>

    <style>
        :root {
            --primary-blue: #007bff;
            --light-blue: #e9f3ff;
            --bg-color: #f4f9ff;
            --text-color: #333;
            --border-radius: 10px;
            --card-shadow: rgba(0, 0, 0, 0.05) 0px 2px 10px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 20px;
            margin: 0;
        }

        h1 {
            text-align: center;
            color: var(--primary-blue);
            margin-bottom: 30px;
        }

        form {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
        }

        .question-block {
            display: none;
            padding: 20px;
            background-color: var(--light-blue);
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .question-block.active {
            display: block;
        }

        label {
            display: inline-block;
            margin: 6px 0;
            cursor: pointer;
        }

        input[type="radio"] {
            margin-right: 8px;
        }

        textarea {
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 6px;
            padding: 10px;
            font-size: 1rem;
            resize: vertical;
            box-sizing: border-box;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 5px var(--primary-blue);
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        button {
            background-color: var(--primary-blue);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            border-radius: 8px;
            cursor: pointer;
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .mjx-container[jax="CHTML"] {
            font-size: 1.05em;
        }
    </style>
</head>

<body>
    <h1>{{ subject }} Quiz</h1>
    <form action="/submit-quiz" method="POST" id="quizForm">
        {% for q in questions %}
        <div class="question-block {% if loop.first %}active{% endif %}" data-index="{{ loop.index0 }}">
            <p><strong>Q{{ loop.index }}:</strong> <span class="mathjax">{{ q.questionText | safe }}</span></p>

            {% if q.questionType == 'MCQ' %}
            {% for opt in q.options %}
            <input type="radio" id="q{{ q.id }}_{{ opt.optionLabel }}" name="answer_{{ q.id }}"
                value="{{ opt.optionLabel }}" required>
            <label for="q{{ q.id }}_{{ opt.optionLabel }}">{{ opt.optionLabel }}. {{ opt.optionText }}</label><br>
            {% endfor %}
            {% elif q.questionType == 'SPR' %}
            <textarea name="answer_{{ q.id }}" rows="3" required></textarea>
            {% endif %}
        </div>
        {% endfor %}

        <div class="nav-buttons">
            <button type="button" id="prevBtn" onclick="changeQuestion(-1)" disabled>Previous</button>
            <button type="button" id="nextBtn" onclick="changeQuestion(1)">Next</button>
            <button type="submit" id="submitBtn" style="display: none;">Submit</button>
        </div>
    </form>

    <script>
        let currentQuestion = 0;
        const questions = document.querySelectorAll('.question-block');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');

        function showQuestion(index) {
            questions.forEach((q, i) => {
                q.classList.toggle('active', i === index);
            });

            prevBtn.disabled = index === 0;
            nextBtn.style.display = index === questions.length - 1 ? 'none' : 'inline-block';
            submitBtn.style.display = index === questions.length - 1 ? 'inline-block' : 'none';
        }

        function changeQuestion(delta) {
            if (delta === 1 && !validateCurrent()) return;

            currentQuestion += delta;
            showQuestion(currentQuestion);
        }

        function validateCurrent() {
            const active = questions[currentQuestion];
            const inputs = active.querySelectorAll('input, textarea');

            for (let input of inputs) {
                if ((input.type === "radio" && input.checked) || input.type === "textarea" && input.value.trim() !== '') {
                    return true;
                }
            }

            alert("Please answer the question before proceeding.");
            return false;
        }

        // Auto-render first question
        showQuestion(currentQuestion);
    </script>
</body>

</html>
